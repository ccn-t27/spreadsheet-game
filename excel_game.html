<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©¦ç®—è¡¨å‡½æ•¸å¤§æŒ‘æˆ°</title>
    <style>
        :root { --primary-color: #2563eb; --success-color: #16a34a; --error-color: #dc2626; --bg-color: #f3f4f6; --card-bg: #ffffff; }
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background-color: var(--card-bg); border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 600px; padding: 30px; text-align: center; overflow: hidden; }
        h1 { color: #333; margin-bottom: 10px; }
        p { color: #666; line-height: 1.6; }
        .hidden { display: none; }
        .btn-start, .btn-next, .btn-restart, .btn-submit { background-color: var(--primary-color); color: white; border: none; padding: 12px 30px; font-size: 1.1rem; border-radius: 8px; cursor: pointer; margin-top: 20px; transition: background 0.3s; }
        .btn-start:hover { background-color: #1d4ed8; }
        .progress-bar { width: 100%; height: 10px; background-color: #e5e7eb; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--primary-color); width: 0%; transition: width 0.3s ease; }
        .question-text { font-size: 1.2rem; font-weight: bold; color: #1f2937; margin-bottom: 25px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { background-color: #f9fafb; border: 2px solid #e5e7eb; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.2s; font-family: monospace; font-weight: bold; }
        .option-btn:hover { border-color: var(--primary-color); background-color: #eff6ff; }
        .feedback-container { margin-top: 20px; text-align: left; background-color: #f8fafc; padding: 20px; border-radius: 8px; border-left: 5px solid #ccc; }
        .feedback-container.correct { border-left-color: var(--success-color); }
        .feedback-container.wrong { border-left-color: var(--error-color); }
        .result-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; }
        .text-correct { color: var(--success-color); }
        .text-wrong { color: var(--error-color); }
        .explanation-box { margin-top: 10px; font-size: 0.95rem; }
        .code-example { background-color: #1e293b; color: #a5f3fc; padding: 10px; border-radius: 5px; font-family: monospace; margin-top: 8px; display: block; }
        .input-group { margin: 20px 0; }
        input[type="text"] { padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; width: 70%; }
        .leaderboard-table { width: 100%; margin-top: 20px; border-collapse: collapse; font-size: 0.9rem; }
        .leaderboard-table th { background: #f3f4f6; padding: 10px; text-align: center; }
        .leaderboard-table td { border-bottom: 1px solid #eee; padding: 10px; }
        .rank-1 { color: #eab308; font-weight: bold; }
        .rank-2 { color: #94a3b8; font-weight: bold; }
        .rank-3 { color: #b45309; font-weight: bold; }
        .loading { color: #999; font-style: italic; }
        @media (max-width: 480px) { .options-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div id="start-screen">
        <h1>ğŸ“Š è©¦ç®—è¡¨å‡½æ•¸å¤§å¸«</h1>
        <p>ç³»çµ±å°‡éš¨æ©ŸæŠ½å‡º 10 é¡Œé€²è¡Œæ¸¬é©—ã€‚<br>é¡Œç›®ç¯„åœï¼šIF, SUM, COUNT, RANK ç­‰åŸºç¤å‡½æ•¸ã€‚<br>æŒ‘æˆ°å…¨å°ï¼Œçˆ­å¥ªé¾è™æ¦œæ¦œé¦–ï¼</p>
        <button class="btn-start" onclick="startGame()">é–‹å§‹æŒ‘æˆ° (10é¡Œ)</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <div class="question-text" id="question">è¼‰å…¥ä¸­...</div>
        <div class="options-grid" id="options-container"></div>
    </div>

    <div id="feedback-screen" class="hidden">
        <div class="feedback-container" id="feedback-box">
            <div class="result-title" id="result-title"></div>
            <div class="explanation-box">
                <p id="explanation-text"></p>
                <strong>ğŸ’¡ ä¾‹å­ï¼š</strong>
                <code class="code-example" id="example-code"></code>
            </div>
        </div>
        <button class="btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
    </div>

    <div id="end-screen" class="hidden">
        <h1>ğŸ‰ æŒ‘æˆ°å®Œæˆï¼</h1>
        <p>ä½ çš„å¾—åˆ†ï¼š <span style="font-size: 2rem; font-weight:bold; color: var(--primary-color);"><span id="final-score">0</span> / <span id="total-questions">0</span></span></p>
        
        <div id="submit-section">
            <p>è¼¸å…¥åå­—ï¼Œç™»ä¸Šé¾è™æ¦œï¼</p>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="ä½ çš„åå­—æˆ–å­¸è™Ÿ" maxlength="10">
                <button class="btn-submit" onclick="submitScore()">æäº¤æˆç¸¾</button>
            </div>
        </div>

        <div id="leaderboard-section" class="hidden">
            <h3>ğŸ† é¾è™æ¦œ (Top 10)</h3>
            <div id="leaderboard-content" class="loading">è¼‰å…¥ä¸­...</div>
            <button class="btn-restart" onclick="startGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // âœ… ä½ çš„ Google Apps Script ç¶²å€ (å·²è‡ªå‹•å¡«å…¥)
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxkhEO_36rhZEu63NdufMgag1DgWz4eBlyhbbf0kKuD6DqrVb7tlfGeUIZ-_USVj6zs/exec"; 
    // ==========================================

    // åš´æ ¼ç¯©é¸å¾Œçš„é¡Œåº« (ç¬¦åˆæ‰€æœ‰æŒ‡å®šåŸºç¤å‡½æ•¸)
    const questionBank = [
        // --- åŸºç¤åŠ ç¸½èˆ‡å¹³å‡ (SUM, AVERAGE) ---
        { question: "è¨ˆç®—å…¨ç­æ¸¬é©—åˆ†æ•¸çš„ã€Œç¸½å’Œã€ã€‚", options: ["SUM", "TOTAL", "ADD", "COUNT"], answer: 0, explanation: "SUM ç”¨æ–¼è¨ˆç®—é¸å®šç¯„åœå…§æ‰€æœ‰æ•¸å­—çš„ç¸½å’Œã€‚", example: "=SUM(A1:A10)" },
        { question: "è¨ˆç®—å…¨ç­çš„ã€Œå¹³å‡åˆ†ã€ã€‚", options: ["MEAN", "AVERAGE", "MEDIAN", "SUM"], answer: 1, explanation: "AVERAGE ç”¨æ–¼è¨ˆç®—ç®—è¡“å¹³å‡å€¼ã€‚", example: "=AVERAGE(A1:A30)" },
        { question: "å¦‚æœä½ æƒ³è¨ˆç®— 5 å€‹ç§‘ç›®çš„ç¸½åˆ†ï¼Œé™¤äº†ç”¨ A1+B1+... å¤–ï¼Œæœ€å¿«çš„æ–¹æ³•æ˜¯ï¼Ÿ", options: ["ADD", "SUM", "PLUS", "TOTAL"], answer: 1, explanation: "SUM å¯ä»¥ç›´æ¥é¸å–ä¸€å€‹ç¯„åœé€²è¡ŒåŠ ç¸½ã€‚", example: "=SUM(A1:E1)" },
        { question: "è¨ˆç®— 1 æœˆåˆ° 12 æœˆçš„å¹³å‡æ”¯å‡ºï¼Œå¿½ç•¥æ²’æœ‰è¼¸å…¥æ•¸å­—çš„æœˆä»½ã€‚", options: ["AVERAGE", "SUM", "COUNT", "INT"], answer: 0, explanation: "AVERAGE å‡½æ•¸æœƒè‡ªå‹•å¿½ç•¥ç©ºç™½å„²å­˜æ ¼ã€‚", example: "=AVERAGE(B2:B13)" },
        { question: "æƒ³è¦å°‡ä¸‰å€‹ä¸é€£çºŒçš„å„²å­˜æ ¼ A1, C1, E1 åŠ ç¸½ã€‚", options: ["SUM", "ADD", "PLUS", "TOTAL"], answer: 0, explanation: "SUM å¯ä»¥æ¥å—å¤šå€‹ä¸é€£çºŒçš„åƒæ•¸ï¼Œç”¨é€—è™Ÿéš”é–‹ã€‚", example: "=SUM(A1, C1, E1)" },

        // --- æœ€å¤§æœ€å°èˆ‡æ¥µå€¼ (MAX, MIN, LARGE, SMALL) ---
        { question: "æ‰¾å‡ºå…¨ç­åˆ†æ•¸ã€Œæœ€é«˜ã€çš„é‚£ä½åŒå­¸çš„åˆ†æ•¸ã€‚", options: ["TOP", "LARGE", "MAX", "RANK"], answer: 2, explanation: "MAX å‡½æ•¸ç”¨æ–¼å›å‚³æœ€å¤§å€¼ã€‚", example: "=MAX(C1:C30)" },
        { question: "æ‰¾å‡ºé€™æ¬¡è€ƒè©¦ä¸­ã€Œæœ€ä½ã€çš„åˆ†æ•¸ã€‚", options: ["MIN", "SMALL", "LOW", "BOTTOM"], answer: 0, explanation: "MIN å‡½æ•¸ç”¨æ–¼å›å‚³æœ€å°å€¼ã€‚", example: "=MIN(C1:C30)" },
        { question: "æƒ³æ‰¾å‡ºå…¨ç­åˆ†æ•¸ã€Œç¬¬ä¸‰é«˜ã€çš„åˆ†æ•¸ï¼ŒMAX åšä¸åˆ°ï¼Œè©²ç”¨ä»€éº¼ï¼Ÿ", options: ["MAX", "LARGE", "RANK", "HIGH"], answer: 1, explanation: "LARGE(ç¯„åœ, k) å¯ä»¥æ‰¾å‡ºç¬¬ k å€‹æœ€å¤§å€¼ã€‚", example: "=LARGE(A1:A10, 3)" },
        { question: "æƒ³æ‰¾å‡ºå…¨ç­è·‘å¾—ã€Œç¬¬äºŒå¿«ã€çš„æ™‚é–“ (æ•¸å€¼è¶Šå°è¶Šå¿«ï¼Œå³ç¬¬äºŒå°å€¼)ã€‚", options: ["MIN", "SMALL", "LOWER", "BOTTOM"], answer: 1, explanation: "SMALL(ç¯„åœ, k) å¯ä»¥æ‰¾å‡ºç¬¬ k å€‹æœ€å°å€¼ã€‚", example: "=SMALL(A1:A10, 2)" },
        { question: "è¦æ‰¾å‡ºå…¬å¸è£¡è–ªæ°´ã€Œç¬¬äº”é«˜ã€çš„é‡‘é¡ã€‚", options: ["RANK", "LARGE", "MAX", "COUNT"], answer: 1, explanation: "ä½¿ç”¨ LARGE å‡½æ•¸ï¼Œè¨­å®š k=5ã€‚", example: "=LARGE(B2:B100, 5)" },

        // --- è¨ˆæ•¸ (COUNT, COUNTA, COUNTBLANK) ---
        { question: "è¨ˆç®—ä¸€åˆ—è³‡æ–™ä¸­æœ‰ã€Œå¤šå°‘å€‹æ•¸å­—ã€ï¼ˆä¸åŒ…å«æ–‡å­—ï¼‰ã€‚", options: ["COUNTA", "COUNT", "COUNTBLANK", "SUM"], answer: 1, explanation: "COUNT åªè¨ˆç®—ã€Œæ•¸å­—ã€ï¼›COUNTA ç®—æ‰€æœ‰éç©ºå€¼ã€‚", example: "=COUNT(A1:A10)" },
        { question: "è¨ˆç®—å‡ºå¸­åå–®ä¸­æœ‰å¡«å¯«è³‡æ–™çš„ç¸½äººæ•¸ï¼ˆç„¡è«–å¡«æ–‡å­—æˆ–æ•¸å­—ï¼‰ã€‚", options: ["COUNT", "COUNTA", "SUM", "TOTAL"], answer: 1, explanation: "COUNTA (Count All) è¨ˆç®—æ‰€æœ‰ã€Œéç©ºç™½ã€å„²å­˜æ ¼ã€‚", example: "=COUNTA(A1:A10)" },
        { question: "è¨ˆç®—è³‡æ–™ç¯„åœä¸­æœ‰å¤šå°‘å€‹ã€Œç©ºæ ¼ã€ï¼ˆç¼ºå¸­/æœªå¡«ï¼‰ã€‚", options: ["COUNT", "EMPTY", "COUNTBLANK", "NULL"], answer: 2, explanation: "COUNTBLANK å°ˆé–€è¨ˆç®—ç©ºç™½å„²å­˜æ ¼ã€‚", example: "=COUNTBLANK(A1:A10)" },
        { question: "å¦‚æœå„²å­˜æ ¼è£¡æ˜¯æ–‡å­— 'Absent'ï¼Œç”¨ COUNT å‡½æ•¸è¨ˆç®—æœƒå¾—åˆ°ä»€éº¼ï¼Ÿ", options: ["1", "0", "éŒ¯èª¤", "TRUE"], answer: 1, explanation: "COUNT åªç®—æ•¸å­—ï¼Œå¿½ç•¥æ–‡å­—ã€‚è¦ç®—æ–‡å­—éœ€ç”¨ COUNTAã€‚", example: "=COUNT(\"Absent\") // çµæœç‚º 0" },
        { question: "æƒ³çŸ¥é“æœ‰å¤šå°‘åŒå­¸ã€Œæ²’æœ‰ã€æäº¤ä½œæ¥­ (è©²æ¬„ä½ç‚ºç©ºç™½)ã€‚", options: ["COUNT", "COUNTA", "COUNTBLANK", "MIN"], answer: 2, explanation: "è¨ˆç®—ç©ºç™½æ ¼çš„æ•¸é‡ï¼Œä½¿ç”¨ COUNTBLANKã€‚", example: "=COUNTBLANK(C2:C40)" },

        // --- æ¢ä»¶é‹ç®— (SUMIF, COUNTIF) ---
        { question: "åªæƒ³åŠ ç¸½ã€ŒåŠæ ¼ã€ï¼ˆåˆ†æ•¸ >= 50ï¼‰åŒå­¸çš„åˆ†æ•¸ã€‚", options: ["SUM", "SUMIF", "COUNTIF", "IF"], answer: 1, explanation: "SUMIF å…è¨±ä½ è¨­å®šä¸€å€‹æ¢ä»¶ï¼Œç¬¦åˆæ‰åŠ ç¸½ã€‚", example: "=SUMIF(A1:A10, \">=50\")" },
        { question: "è¨ˆç®—ç­ä¸Šã€Œç”·åŒå­¸ã€çš„ç¸½äººæ•¸ (è³‡æ–™ç‚º 'M')ã€‚", options: ["COUNT", "SUMIF", "COUNTIF", "COUNTA"], answer: 2, explanation: "COUNTIF è¨ˆç®—ç¬¦åˆç‰¹å®šæ¢ä»¶çš„å€‹æ•¸ã€‚", example: "=COUNTIF(B2:B20, \"M\")" },
        { question: "è¨ˆç®—æ‰€æœ‰ã€Œå¤§æ–¼ 1000 å…ƒã€çš„è¨‚å–®æ•¸é‡ã€‚", options: ["COUNT", "COUNTIF", "SUMIF", "LARGE"], answer: 1, explanation: "COUNTIF å¯ä»¥è¨­å®šæ•¸å­—æ¢ä»¶ï¼Œä¾‹å¦‚ \">1000\"ã€‚", example: "=COUNTIF(C2:C100, \">1000\")" },
        { question: "æƒ³è¨ˆç®—ã€Œæ–‡å…·éƒ¨ã€çš„ç¸½éŠ·å”®é¡ (éƒ¨é–€åœ¨ A æ¬„ï¼Œé‡‘é¡åœ¨ B æ¬„)ã€‚", options: ["SUM", "SUMIF", "DSUM", "TOTALIF"], answer: 1, explanation: "SUMIF(ç¯„åœ, æ¢ä»¶, åŠ ç¸½ç¯„åœ)ã€‚", example: "=SUMIF(A:A, \"æ–‡å…·éƒ¨\", B:B)" },
        { question: "è¨ˆç®—æœ‰å¤šå°‘å€‹å­¸ç”Ÿçš„æˆç¸¾æ˜¯ã€Œ100 åˆ†ã€æ»¿åˆ†ã€‚", options: ["MAX", "COUNT", "COUNTIF", "RANK"], answer: 2, explanation: "COUNTIF å¯ä»¥ç²¾ç¢ºè¨ˆç®—ç­‰æ–¼æŸå€‹æ•¸å€¼çš„å€‹æ•¸ã€‚", example: "=COUNTIF(D2:D40, 100)" },
        { question: "è¨ˆç®—æœ‰å¤šå°‘å€‹æˆç¸¾æ˜¯ã€Œä¸åŠæ ¼ã€çš„ (<60)ã€‚", options: ["COUNT", "SUMIF", "COUNTIF", "IF"], answer: 2, explanation: "COUNTIF ç”¨æ–¼è¨ˆç®—ç¬¦åˆæ¢ä»¶çš„å„²å­˜æ ¼æ•¸é‡ã€‚", example: "=COUNTIF(A1:A10, \"<60\")" },

        // --- æ’åèˆ‡çµ±è¨ˆ (RANK, MEDIAN, MODE) ---
        { question: "æƒ³çŸ¥é“æŸä½åŒå­¸çš„åˆ†æ•¸åœ¨å…¨ç­æ’ç¬¬å¹¾åã€‚", options: ["SORT", "ORDER", "RANK", "LEVEL"], answer: 2, explanation: "RANK å‚³å›æŸæ•¸å€¼åœ¨åˆ—è¡¨ä¸­çš„æ’åã€‚", example: "=RANK(A2, A$2:A$40)" },
        { question: "çµ±è¨ˆå­¸ä¸­ï¼Œæƒ³æ‰¾å‡ºé€™çµ„åˆ†æ•¸çš„ã€Œä¸­ä½æ•¸ã€ï¼ˆä¸­é–“é‚£å€‹æ•¸ï¼‰ã€‚", options: ["MIDDLE", "MEDIAN", "AVERAGE", "MODE"], answer: 1, explanation: "MEDIAN æ‰¾å‡ºæ•¸å€¼ç¾¤çµ„ä¸­é–“çš„æ•¸å€¼ï¼Œé¿å…è¢«æ¥µç«¯å€¼å½±éŸ¿ã€‚", example: "=MEDIAN(A1:A10)" },
        { question: "çµ±è¨ˆå­¸ä¸­ï¼Œæƒ³æ‰¾å‡ºé€™çµ„åˆ†æ•¸ä¸­ã€Œå‡ºç¾æ¬¡æ•¸æœ€å¤šã€çš„åˆ†æ•¸ï¼ˆçœ¾æ•¸ï¼‰ã€‚", options: ["MOST", "MAX", "MODE", "POPULAR"], answer: 2, explanation: "MODE å‚³å›å‡ºç¾é »ç‡æœ€é«˜çš„æ•¸å€¼ã€‚", example: "=MODE(A1:A10)" },
        { question: "å¦‚æœæœ‰ä¸€çµ„æ•¸å­—ï¼š1, 2, 9, 9, 10ã€‚MODE å‡½æ•¸çš„çµæœæ˜¯ï¼Ÿ", options: ["1", "9", "6.2", "10"], answer: 1, explanation: "MODE æ‰¾çœ¾æ•¸ï¼ˆå‡ºç¾æœ€å¤šæ¬¡çš„æ•¸ï¼‰ï¼Œ9 å‡ºç¾äº†å…©æ¬¡ã€‚", example: "=MODE(A1:A5)" },
        { question: "RANK å‡½æ•¸å¦‚æœä¸æŒ‡å®šç¬¬ä¸‰å€‹åƒæ•¸ï¼Œé è¨­æ’åæ–¹å¼æ˜¯ï¼Ÿ", options: ["éå¢ (åˆ†æ•¸ä½ç¬¬ä¸€å)", "éæ¸› (åˆ†æ•¸é«˜ç¬¬ä¸€å)", "éš¨æ©Ÿ", "ä¾è¼¸å…¥é †åº"], answer: 1, explanation: "RANK é è¨­æ˜¯éæ¸›æ’åº (Desc)ï¼Œå³æ•¸å­—è¶Šå¤§æ’åè¶Šå‰ã€‚", example: "=RANK(A1, A1:A10)" },

        // --- é‚è¼¯åˆ¤æ–· (IF, AND, OR, NOT) ---
        { question: "å¦‚æœ A1>=60 é¡¯ç¤ºã€ŒåŠæ ¼ã€ï¼Œå¦å‰‡é¡¯ç¤ºã€Œä¸åŠæ ¼ã€ã€‚", options: ["CHECK", "IF", "THEN", "WHEN"], answer: 1, explanation: "IF(æ¢ä»¶, æˆç«‹å€¼, ä¸æˆç«‹å€¼)ã€‚", example: "=IF(A1>=60, \"åŠæ ¼\", \"ä¸åŠæ ¼\")" },
        { question: "åˆ¤æ–·æ˜¯å¦ã€Œå…©ç§‘éƒ½åŠæ ¼ã€ã€‚æ¢ä»¶ï¼šä¸­æ–‡>50 ä¸” è‹±æ–‡>50ã€‚", options: ["OR", "IF", "AND", "BOTH"], answer: 2, explanation: "AND åœ¨ã€Œæ‰€æœ‰ã€æ¢ä»¶éƒ½ç‚º TRUE æ™‚æ‰å›å‚³ TRUEã€‚", example: "=AND(A1>50, B1>50)" },
        { question: "åˆ¤æ–·æ˜¯å¦ã€Œè‡³å°‘æœ‰ä¸€ç§‘åŠæ ¼ã€ã€‚æ¢ä»¶ï¼šä¸­æ–‡>50 æˆ– è‹±æ–‡>50ã€‚", options: ["AND", "OR", "IF", "MAYBE"], answer: 1, explanation: "OR åªè¦æœ‰ã€Œä»»ä½•ä¸€å€‹ã€æ¢ä»¶ç‚º TRUE å°±å›å‚³ TRUEã€‚", example: "=OR(A1>50, B1>50)" },
        { question: "å°‡ TRUE è®Šæˆ FALSEï¼Œæˆ–å°‡ FALSE è®Šæˆ TRUEã€‚", options: ["SWAP", "IF", "NOT", "CHANGE"], answer: 2, explanation: "NOT ç”¨æ–¼åè½‰é‚è¼¯å€¼ã€‚", example: "=NOT(TRUE) // çµæœç‚º FALSE" },
        { question: "æƒ³æ ¹æ“šå¹´é½¡çµ¦äºˆå„ªæƒ ï¼šå¦‚æœ Age<12 æˆ– Age>60ï¼Œé¡¯ç¤º \"åŠåƒ¹\"ï¼Œå¦å‰‡ \"åŸåƒ¹\"ã€‚", options: ["AND", "OR", "IF+OR", "IF+AND"], answer: 2, explanation: "éœ€è¦ IF æ­é… ORã€‚å¦‚æœ (å°æ–¼12 æˆ– å¤§æ–¼60) æˆç«‹...", example: "=IF(OR(A1<12, A1>60), \"åŠåƒ¹\", \"åŸåƒ¹\")" },
        { question: "æª¢æŸ¥åº«å­˜ï¼šå¦‚æœæ•¸é‡å°æ–¼ 5ï¼Œé¡¯ç¤º \"è£œè²¨\"ï¼Œå¦å‰‡é¡¯ç¤ºç©ºç™½ã€‚", options: ["IF", "COUNTIF", "CHECK", "AND"], answer: 0, explanation: "IF å‡½æ•¸æœ€é©åˆé€™ç¨®äºŒé¸ä¸€çš„æƒ…æ³ã€‚", example: "=IF(A2<5, \"è£œè²¨\", \"\")" },
        { question: "åªæœ‰ç•¶ A1 å’Œ B1 éƒ½ç­‰æ–¼ \"Yes\" æ™‚æ‰é¡¯ç¤º \"Pass\"ã€‚", options: ["IF+OR", "IF+AND", "COUNTIF", "SUMIF"], answer: 1, explanation: "éœ€è¦ IF è£¡é¢åŒ…ä¸€å€‹ ANDã€‚", example: "=IF(AND(A1=\"Yes\", B1=\"Yes\"), \"Pass\", \"\")" },

        // --- æ•¸å€¼è™•ç† (ROUND, INT, ABS, SQRT) ---
        { question: "éœ€è¦è¨ˆç®—ä¸€å€‹æ•¸å€¼çš„ã€Œçµ•å°å€¼ã€ï¼ˆå°‡è² æ•¸è®Šæ­£æ•¸ï¼‰ã€‚", options: ["ABS", "INT", "POS", "ROUND"], answer: 0, explanation: "ABS (Absolute) å›å‚³çµ•å°å€¼ã€‚", example: "=ABS(-15) // çµæœ 15" },
        { question: "å°‡ 3.14159 å››æ¨äº”å…¥åˆ°ã€Œå°æ•¸é»å¾Œå…©ä½ã€ã€‚", options: ["INT", "ROUND", "ROUNDUP", "FIXED"], answer: 1, explanation: "ROUND(æ•¸å­—, ä½æ•¸) ç”¨æ–¼å››æ¨äº”å…¥ã€‚", example: "=ROUND(3.14159, 2) // 3.14" },
        { question: "åªæƒ³ä¿ç•™æ•¸å­—çš„ã€Œæ•´æ•¸éƒ¨åˆ†ã€ï¼Œç„¡æ¢ä»¶æ¨å»å°æ•¸ï¼ˆä¾‹ 5.9 è®Š 5ï¼‰ã€‚", options: ["ROUND", "ABS", "INT", "FLOOR"], answer: 2, explanation: "INT å‘ä¸‹å–æ•´è‡³æœ€æ¥è¿‘çš„æ•´æ•¸ã€‚", example: "=INT(5.99) // 5" },
        { question: "è¨ˆç®— 144 çš„ã€Œå¹³æ–¹æ ¹ã€ã€‚", options: ["SQRT", "SQUARE", "POWER", "ROOT"], answer: 0, explanation: "SQRT (Square Root) è¨ˆç®—å¹³æ–¹æ ¹ã€‚", example: "=SQRT(144) // 12" },
        { question: "å¦‚æœè¦è¨ˆç®—å…©å€‹åœ°é»çš„è·é›¢å·® (A1 - B1)ï¼Œä½†ä¸å¸Œæœ›å‡ºç¾è² æ•¸ã€‚", options: ["IF", "INT", "ABS", "MIN"], answer: 2, explanation: "ç”¨ ABS åŒ…ä½ç›¸æ¸›çš„å…¬å¼ï¼Œç¢ºä¿çµæœæ°¸é æ˜¯æ­£æ•¸ã€‚", example: "=ABS(A1-B1)" },
        { question: "æƒ³æŠŠå…¨ç­å¹³å‡åˆ† 85.6789 è®Šæˆæ•´æ•¸ 86 (å››æ¨äº”å…¥)ã€‚", options: ["INT", "ROUND", "TRUNC", "ABS"], answer: 1, explanation: "ROUND å¯ä»¥å››æ¨äº”å…¥ï¼›INT æœƒè®Šæˆ 85ã€‚", example: "=ROUND(85.6789, 0)" },
        { question: "INT(-5.5) çš„çµæœæ˜¯å¤šå°‘ï¼Ÿ", options: ["-5", "-6", "-5.5", "5"], answer: 1, explanation: "INT æ˜¯ã€Œå‘ä¸‹ã€å–æ•´ï¼Œ-5.5 å‘ä¸‹æ˜¯ -6ã€‚", example: "=INT(-5.5)" },

        // --- éš¨æ©Ÿæ•¸ (RAND) ---
        { question: "è¦ç”¢ç”Ÿä¸€å€‹ 0 åˆ° 1 ä¹‹é–“çš„éš¨æ©Ÿå°æ•¸ã€‚", options: ["RANDOM", "RAND", "RND", "CHANCE"], answer: 1, explanation: "RAND() ä¸éœ€è¦åƒæ•¸ï¼Œå›å‚³ 0~1 ä¹‹é–“çš„éš¨æ©Ÿæ•¸ã€‚", example: "=RAND()" },
        { question: "RAND() å‡½æ•¸æ¯æ¬¡é‡æ–°è¨ˆç®—è©¦ç®—è¡¨æ™‚ï¼Œæ•¸å€¼æœƒ...", options: ["ä¿æŒä¸è®Š", "è‡ªå‹•æ”¹è®Š", "è®Šæˆ 0", "è®Šæˆ 1"], answer: 1, explanation: "RAND æ˜¯æ˜“è®Šå‡½æ•¸ï¼Œæ¯æ¬¡æ“ä½œè©¦ç®—è¡¨éƒ½æœƒé‡æ–°ç”¢ç”Ÿæ–°æ•¸å­—ã€‚", example: "=RAND()" },
        { question: "æƒ³ç”¨ RAND ç”¢ç”Ÿä¸€å€‹ 0 åˆ° 10 ä¹‹é–“çš„éš¨æ©Ÿæ•¸ï¼Œå…¬å¼æ˜¯ï¼Ÿ", options: ["=RAND()+10", "=RAND()*10", "=RAND(10)", "=INT(10)"], answer: 1, explanation: "RAND() ç”¢ç”Ÿ 0~1ï¼Œä¹˜ä»¥ 10 å°±è®Šæˆ 0~10ã€‚", example: "=RAND()*10" },

        // --- ç¶œåˆæ‡‰ç”¨ (çµ„åˆæŠ€) ---
        { question: "å¦‚æœ A1 æ˜¯è² æ•¸ï¼Œé¡¯ç¤º \"Error\"ï¼Œå¦å‰‡è¨ˆç®— A1 çš„å¹³æ–¹æ ¹ã€‚", options: ["IF+SQRT", "SQRT", "ABS", "IF"], answer: 0, explanation: "å…ˆç”¨ IF æª¢æŸ¥æ˜¯å¦å°æ–¼0ï¼Œé¿å… SQRT å‡ºéŒ¯ã€‚", example: "=IF(A1<0, \"Error\", SQRT(A1))" },
        { question: "è¦ç®—å‡ºå…¨ç­ã€ŒåŠæ ¼äººæ•¸ã€ä½”ã€Œç¸½äººæ•¸ã€çš„ç™¾åˆ†æ¯”ã€‚", options: ["COUNTIF / COUNTA", "SUM / COUNT", "AVERAGE", "RANK"], answer: 0, explanation: "å…ˆç”¨ COUNTIF ç®—åŠæ ¼äººæ•¸ï¼Œå†é™¤ä»¥ COUNTA ç®—å‡ºçš„ç¸½äººæ•¸ã€‚", example: "=COUNTIF(..)/COUNTA(..)" },
        { question: "æ‰¾å‡ºç­ä¸Šã€Œç¼ºè€ƒã€(ç©ºæ ¼) çš„åŒå­¸æ¯”ä¾‹ã€‚", options: ["COUNTBLANK / COUNTA", "COUNTIF / SUM", "AVERAGE", "MIN"], answer: 0, explanation: "ç©ºç™½æ ¼æ•¸é‡é™¤ä»¥ç¸½äººæ•¸ã€‚", example: "=COUNTBLANK(A:A)/COUNTA(A:A)" },
        { question: "å¦‚æœè¦éš¨æ©ŸæŠ½å‡ºä¸€ä½åŒå­¸ (1~30è™Ÿ)ï¼Œå¯ä»¥ç”¨ INT æ­é…å“ªå€‹å‡½æ•¸ï¼Ÿ", options: ["RAND", "ROUND", "ABS", "SQRT"], answer: 0, explanation: "INT(RAND()*30)+1 å¯ä»¥ç”¢ç”Ÿ 1 åˆ° 30 çš„æ•´æ•¸ã€‚", example: "=INT(RAND()*30)+1" }
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let shuffledQuestions = [];

    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const feedbackScreen = document.getElementById('feedback-screen');
    const endScreen = document.getElementById('end-screen');
    
    const submitSection = document.getElementById('submit-section');
    const leaderboardSection = document.getElementById('leaderboard-section');
    const leaderboardContent = document.getElementById('leaderboard-content');

    function startGame() {
        currentQuestionIndex = 0;
        score = 0;
        
        // --- æ ¸å¿ƒä¿®æ”¹ï¼šéš¨æ©Ÿæ´—ç‰Œä¸¦åªå–å‰ 10 é¡Œ ---
        // 1. è¤‡è£½é¡Œåº«ä¸¦éš¨æ©Ÿæ’åº
        const allQuestions = [...questionBank].sort(() => 0.5 - Math.random());
        // 2. åˆ‡å‰²å‡ºå‰ 10 é¡Œ (å¦‚æœé¡Œåº«ä¸å¤  10 é¡Œå‰‡å–å…¨éƒ¨)
        shuffledQuestions = allQuestions.slice(0, 10);
        // -------------------------------------
        
        startScreen.classList.add('hidden');
        endScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        leaderboardSection.classList.add('hidden');
        submitSection.classList.remove('hidden');
        
        showQuestion();
    }

    function showQuestion() {
        const qData = shuffledQuestions[currentQuestionIndex];
        
        // é€²åº¦æ¢é¡¯ç¤º
        const totalQ = shuffledQuestions.length;
        document.getElementById('progress').style.width = `${((currentQuestionIndex)/totalQ)*100}%`;
        
        // é¡¯ç¤ºé¡Œç›®
        document.getElementById('question').innerHTML = 
            `<span style="font-size:0.8em; color:#666">ç¬¬ ${currentQuestionIndex + 1}/${totalQ} é¡Œ</span><br>${qData.question}`;
        
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx);
            container.appendChild(btn);
        });
    }

    function checkAnswer(idx) {
        const qData = shuffledQuestions[currentQuestionIndex];
        const isCorrect = idx === qData.answer;
        if(isCorrect) score++;

        quizScreen.classList.add('hidden');
        feedbackScreen.classList.remove('hidden');
        
        const feedbackBox = document.getElementById('feedback-box');
        const resultTitle = document.getElementById('result-title');
        feedbackBox.className = 'feedback-container ' + (isCorrect ? 'correct' : 'wrong');
        resultTitle.innerHTML = isCorrect ? '<span class="text-correct">âœ… ç­”å°äº†ï¼</span>' : `<span class="text-wrong">âŒ ç­”éŒ¯äº†ï¼</span> æ­£ç¢º: <strong>${qData.options[qData.answer]}</strong>`;
        
        document.getElementById('explanation-text').innerText = qData.explanation;
        document.getElementById('example-code').innerText = qData.example;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        feedbackScreen.classList.add('hidden');
        if (currentQuestionIndex < shuffledQuestions.length) {
            quizScreen.classList.remove('hidden');
            showQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        endScreen.classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
        document.getElementById('total-questions').innerText = shuffledQuestions.length;
    }

    function submitScore() {
        const name = document.getElementById('player-name').value.trim();
        if (!name) { alert("è«‹è¼¸å…¥åå­—ï¼"); return; }
        // ç§»é™¤ URL æª¢æŸ¥ï¼Œå› ç‚ºç¾åœ¨ URL æ˜¯å¯«æ­»çš„æ­£ç¢ºç¶²å€
        
        const btn = document.querySelector('.btn-submit');
        btn.disabled = true;
        btn.innerText = "æäº¤ä¸­...";

        fetch(GAS_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name, score: score })
        }).then(() => {
            loadLeaderboard();
        }).catch(err => {
            alert("æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡");
            btn.disabled = false;
        });
    }

    function loadLeaderboard() {
        submitSection.classList.add('hidden');
        leaderboardSection.classList.remove('hidden');
        
        fetch(GAS_URL)
        .then(response => response.json())
        .then(data => {
            let html = `<table class="leaderboard-table"><tr><th>æ’å</th><th>åå­—</th><th>å¾—åˆ†</th></tr>`;
            data.forEach((row, index) => {
                let rankClass = index === 0 ? 'rank-1' : (index === 1 ? 'rank-2' : (index === 2 ? 'rank-3' : ''));
                let rankIcon = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : index + 1));
                html += `<tr><td class="${rankClass}">${rankIcon}</td><td class="${rankClass}">${row.name}</td><td>${row.score}</td></tr>`;
            });
            html += `</table>`;
            leaderboardContent.innerHTML = html;
        })
        .catch(err => {
            leaderboardContent.innerText = "ç„¡æ³•è¼‰å…¥æ’è¡Œæ¦œ";
            console.error(err);
        });
    }
</script>
</body>
</html>
